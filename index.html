<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>IBD Clinical & PBS Prescribing Guide</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #0f172a;
            --primary-light: #f8fafc;
            --primary-border: #e2e8f0;
            --secondary: #2563eb;
            --secondary-light: #eff6ff;
            --accent: #0ea5e9;
            --text-dark: #1e293b;
            --text-muted: #475569;
            --bg-body: #f1f5f9;
            --bg-card: #ffffff;
            
            --success: #10b981;
            --success-light: #dcfce7;
            --warning: #f59e0b;
            --warning-light: #fef3c7;
            --danger: #ef4444;
            --streamlined: #8b5cf6;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body { font-family: 'Inter', sans-serif; background-color: var(--bg-body); color: var(--text-dark); line-height: 1.6; -webkit-font-smoothing: antialiased; }

        /* --- HEADER & MAIN CONTROLS --- */
        header { background: linear-gradient(135deg, var(--primary), #1e3a8a); color: white; padding: 2.5rem 5% 4rem 5%; text-align: center; }
        header h1 { font-size: clamp(1.8rem, 5vw, 2.5rem); font-weight: 700; margin-bottom: 0.5rem; letter-spacing: -0.02em; }
        header p { font-size: clamp(0.9rem, 3vw, 1.1rem); font-weight: 300; opacity: 0.9; max-width: 650px; margin: 0 auto 1.5rem auto; }

        .context-toggle-wrapper { display: flex; justify-content: center; align-items: center; gap: 1rem; margin-bottom: 1rem; }
        .context-toggle { background: rgba(255, 255, 255, 0.1); border-radius: 99px; padding: 0.3rem; display: inline-flex; border: 1px solid rgba(255,255,255,0.2); max-width: 100%; overflow-x: auto;}
        .context-btn {
            background: transparent; border: none; color: rgba(255,255,255,0.7); font-family: inherit; font-size: clamp(0.8rem, 2vw, 0.95rem); font-weight: 600;
            padding: 0.6rem 1.2rem; border-radius: 99px; cursor: pointer; transition: all 0.2s; white-space: nowrap;
        }
        .context-btn:hover { color: white; }
        .context-btn.active { background: white; color: var(--primary); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }

        .main-controls { max-width: 1200px; margin: -2rem auto 2rem auto; background: white; padding: 1.25rem; border-radius: 16px; box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1); display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 1rem; position: relative; z-index: 10; width: 92%; }
        
        .form-control { width: 100%; padding: 0.875rem 1rem; border: 1px solid var(--primary-border); border-radius: 8px; font-family: inherit; font-size: 0.95rem; outline: none; transition: all 0.2s; background-color: var(--primary-light); appearance: none; -webkit-appearance: none;}
        .form-control:focus { border-color: var(--secondary); background-color: white; box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
        select.form-control { background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23475569%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E"); background-repeat: no-repeat; background-position: right 1rem top 50%; background-size: 0.65rem auto; padding-right: 2.5rem; }

        /* --- GRID & CARDS --- */
        .container { max-width: 1200px; margin: 0 auto; padding: 0 1rem 3rem 1rem; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1rem; }
        .card { background: var(--bg-card); border: 1px solid var(--primary-border); border-radius: 16px; padding: 1.25rem; cursor: pointer; transition: all 0.2s; display: flex; flex-direction: column; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .card:hover { transform: translateY(-4px); box-shadow: 0 12px 25px -5px rgba(0, 0, 0, 0.1); border-color: var(--accent); }
        .card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.25rem; }
        .card-title { font-size: 1.2rem; font-weight: 700; color: var(--primary); }
        .card-brand { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 1rem; line-height: 1.3; }
        
        .badges { display: flex; gap: 0.4rem; flex-wrap: wrap; margin-top: auto; }
        .badge { padding: 0.25rem 0.5rem; border-radius: 6px; font-size: 0.65rem; font-weight: 700; color: white; text-transform: uppercase; letter-spacing: 0.05em; }
        .bg-iv { background: var(--success); } .bg-sc { background: var(--warning); color: #000; } .bg-po { background: var(--secondary); }
        .bg-ind { background: #e2e8f0; color: var(--primary); } .bg-class { background: var(--primary); }

        /* --- MODAL --- */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(15, 23, 42, 0.75); backdrop-filter: blur(4px); display: flex; justify-content: center; align-items: center; z-index: 100; opacity: 0; pointer-events: none; transition: opacity 0.2s; padding: 1rem; }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }
        .modal-content { background: white; width: 100%; max-width: 1200px; height: 95vh; border-radius: 16px; display: flex; flex-direction: column; transform: translateY(20px) scale(0.98); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); }
        .modal-overlay.active .modal-content { transform: translateY(0) scale(1); }
        
        .modal-header { padding: 1.25rem 1.5rem; border-bottom: 1px solid var(--primary-border); display: flex; justify-content: space-between; align-items: flex-start; }
        .close-btn { background: #f1f5f9; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-dark); width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: background 0.2s; flex-shrink: 0;}
        .close-btn:hover { background: #e2e8f0; color: var(--danger); }
        .modal-body { padding: 0; overflow-y: auto; flex: 1; display: flex; flex-direction: column; -webkit-overflow-scrolling: touch; }

        /* --- TABS --- */
        .tabs { display: flex; background: #f8fafc; border-bottom: 1px solid var(--primary-border); position: sticky; top: 0; z-index: 10; overflow-x: auto; scrollbar-width: none; -webkit-overflow-scrolling: touch;}
        .tabs::-webkit-scrollbar { display: none; }
        .tab { flex: 1; min-width: max-content; text-align: center; padding: 1rem; cursor: pointer; font-weight: 600; font-size: 0.9rem; color: var(--text-muted); border-bottom: 3px solid transparent; transition: all 0.2s; }
        .tab:hover { color: var(--secondary); background: white; }
        .tab.active { color: var(--secondary); border-bottom-color: var(--secondary); background: white; }
        .tab-content { display: none; padding: 1.5rem; animation: fadeIn 0.2s ease-in; flex: 1;}
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* --- TYPOGRAPHY --- */
        h3 { color: var(--primary); margin: 1.25rem 0 0.5rem 0; font-size: 1.1rem; border-bottom: 2px solid var(--primary-light); padding-bottom: 0.4rem;}
        h3:first-child { margin-top: 0; }
        ul { margin-left: 1.25rem; margin-bottom: 1rem; color: var(--text-dark); }
        li { margin-bottom: 0.4rem; font-size: 0.95rem; }
        .highlight-text { font-weight: 600; color: var(--primary); }
        
        .alert-box { padding: 1rem; border-radius: 8px; margin-bottom: 1rem; font-size: 0.9rem; line-height: 1.4; background: #eff6ff; border: 1px solid #bfdbfe; color: #1e40af; }
        .alert-box.warning { background: #fffbeb; border-color: #fde68a; color: #b45309; }
        .alert-box.danger { background: #fef2f2; border-color: #fecaca; color: #be123c; }

        /* --- ESCALATION CARDS --- */
        .escalation-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem; }
        .esc-card { border-radius: 12px; border: 1px solid; overflow: hidden; }
        .esc-header { padding: 0.8rem 1rem; font-weight: 700; font-size: 1rem; display: flex; align-items: center; gap: 0.5rem; }
        .esc-body { padding: 1rem; background: white; font-size: 0.9rem; }
        .esc-body p { margin-bottom: 0.5rem; }
        .esc-body ul { margin-bottom: 0; }
        .esc-pbs { border-color: #86efac; } .esc-pbs .esc-header { background: var(--success-light); color: #166534; }
        .esc-comp { border-color: #fcd34d; } .esc-comp .esc-header { background: var(--warning-light); color: #92400e; }

        /* --- PBS CONTROLS & TABLE --- */
        .pbs-controls-header { display: flex; flex-direction: column; gap: 1rem; margin-bottom: 1rem; }
        .pill-group { display: flex; gap: 0.5rem; flex-wrap: wrap; align-items: center; }
        .pill-btn { padding: 0.4rem 1rem; border-radius: 99px; border: 1px solid var(--primary-border); background: white; font-size: 0.85rem; font-weight: 600; color: var(--text-muted); cursor: pointer; transition: all 0.2s; }
        .pill-btn:hover { border-color: var(--secondary); color: var(--secondary); }
        .pill-btn.active { background: var(--secondary); color: white; border-color: var(--secondary); box-shadow: 0 4px 6px -1px rgba(37,99,235,0.2); }
        .context-badge { padding: 0.3rem 0.6rem; border-radius: 6px; font-size: 0.75rem; font-weight: 700; background: var(--primary-light); color: var(--primary); border: 1px solid var(--primary-border); }

        .phase-explainer { background: white; border: 1px solid var(--primary-border); border-radius: 8px; overflow: hidden; }
        .phase-explainer-header { padding: 0.75rem 1rem; background: var(--primary-light); font-weight: 600; font-size: 0.85rem; cursor: pointer; display: flex; justify-content: space-between; align-items: center; color: var(--text-dark); }
        .phase-explainer-content { padding: 1rem; font-size: 0.85rem; display: none; border-top: 1px solid var(--primary-border); background: white; }
        .phase-explainer-content.active { display: block; }
        
        .weight-calculator { background: var(--secondary-light); border: 1px solid #bfdbfe; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;}
        .weight-input { width: 80px; padding: 0.5rem; border: 1px solid #93c5fd; border-radius: 6px; font-weight: bold; font-size: 1rem; text-align: center; outline: none; }
        .weight-result { font-size: 0.95rem; color: var(--secondary); flex: 1; }

        /* Desktop Table View */
        .pbs-table-wrapper { overflow-x: auto; border-radius: 8px; border: 1px solid var(--primary-border); background: white; }
        .pbs-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; text-align: left; }
        .pbs-table th, .pbs-table td { border-bottom: 1px solid var(--primary-border); padding: 0.75rem 1rem; vertical-align: middle; }
        .pbs-table th { background-color: var(--primary-light); color: var(--primary); font-weight: 600; white-space: nowrap; }
        .pbs-table tr:last-child td { border-bottom: none; }
        .pbs-table tbody tr:hover { background-color: #f8fafc; }
        
        .auth-badge { padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.7rem; font-weight: 700; text-transform: uppercase; white-space: nowrap; display: inline-block;}
        .auth-streamlined { background: #ede9fe; color: #6d28d9; border: 1px solid #ddd6fe; }
        .auth-written { background: #e0f2fe; color: #0369a1; border: 1px solid #bae6fd; }
        .auth-phone { background: #ffedd5; color: #c2410c; border: 1px solid #fed7aa; }

        .code-pill { display: inline-flex; align-items: center; gap: 0.4rem; background: #f1f5f9; padding: 0.3rem 0.5rem; border-radius: 6px; font-family: monospace; font-size: 0.9rem; font-weight: 700; color: var(--primary); cursor: pointer; border: 1px solid var(--primary-border); transition: all 0.2s; white-space: nowrap;}
        .code-pill:active { transform: scale(0.95); }
        .code-pill::after { content: 'üìã'; font-size: 0.75rem; filter: grayscale(1); opacity: 0.6;}
        .code-copied { background: var(--success) !important; color: white !important; border-color: var(--success) !important; }
        .code-copied::after { content: '‚úì'; filter: none; opacity: 1;}
        .code-streamline { color: #6d28d9; background: #f5f3ff; border-color: #ede9fe; }

        .qty-badge { background: #f1f5f9; color: var(--primary); padding: 2px 8px; border-radius: 4px; font-weight: 700; border: 1px solid #e2e8f0; text-align: center; display: inline-block;}
        .rpt-badge { background: #dcfce7; color: #166534; padding: 2px 8px; border-radius: 4px; font-weight: 700; border: 1px solid #bbf7d0; text-align: center; display: inline-block;}
        .td-codes { display: flex; flex-direction: column; gap: 0.3rem; align-items: flex-start; }

        /* --- MOBILE OPTIMIZATION --- */
        @media(max-width: 768px) {
            .main-controls { grid-template-columns: 1fr; margin-top: -1.5rem; padding: 1rem; width: 90%; }
            .modal-overlay { padding: 0; align-items: flex-end; }
            .modal-content { height: 95vh; max-height: 95vh; border-radius: 20px 20px 0 0; transform: translateY(100%); }
            .modal-header { padding: 1rem; border-radius: 20px 20px 0 0;}
            #modalTitle { font-size: 1.4rem; }
            .tab-content { padding: 1rem; }
            .escalation-grid { grid-template-columns: 1fr; }
            .context-badge { margin-left: 0; width: 100%; text-align: center;}
            
            /* Responsive Card-Based Table for Mobile */
            .pbs-table-wrapper { border: none; background: transparent; }
            .pbs-table thead { display: none; }
            .pbs-table, .pbs-table tbody, .pbs-table tr, .pbs-table td { display: block; width: 100%; }
            .pbs-table tr { margin-bottom: 1rem; border: 1px solid var(--primary-border); border-radius: 12px; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.02); overflow: hidden;}
            .pbs-table td { 
                display: flex; justify-content: space-between; align-items: center; 
                padding: 0.75rem 1rem; border-bottom: 1px solid #f1f5f9; text-align: right;
            }
            .pbs-table td::before { 
                content: attr(data-label); font-weight: 600; color: var(--text-muted); 
                font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.05em; padding-right: 1rem; text-align: left;
            }
            .pbs-table td:last-child { border-bottom: none; }
            .td-codes { align-items: flex-end; }
        }
    </style>
</head>
<body>

    <header>
        <h1>IBD Clinical Guide</h1>
        <p>Interactive prescribing tool with mobile-optimized PBS codes, calculators, and escalation rules.</p>
        
        <div class="context-toggle-wrapper">
            <div class="context-toggle">
                <button class="context-btn active" id="btn-context-public" onclick="setGlobalContext('public')">üè• Public Hosp (S100)</button>
                <button class="context-btn" id="btn-context-private" onclick="setGlobalContext('private')">üè¢ Private / Community</button>
            </div>
        </div>
    </header>

    <div class="main-controls">
        <input type="text" id="searchInput" class="form-control" placeholder="Search drug (e.g. Stelara, Rinvoq)...">
        <select id="indicationFilter" class="form-control">
            <option value="all">All Indications</option>
            <option value="UC">Ulcerative Colitis (UC)</option>
            <option value="CD">Crohn's Disease (CD)</option>
            <option value="ASUC">Acute Severe UC (ASUC)</option>
            <option value="fCD">Fistulising CD (fCD)</option>
        </select>
        <select id="classFilter" class="form-control">
            <option value="all">All Classes</option>
            <option value="Anti-TNFŒ±">Anti-TNFŒ±</option>
            <option value="Anti-Integrin / IL">Anti-Integrin / Anti-Interleukin</option>
            <option value="JAK Inhibitor">JAK Inhibitors</option>
            <option value="S1P Agonist">S1P Agonists</option>
        </select>
    </div>

    <div class="container">
        <div class="grid" id="med-grid"></div>
    </div>

    <!-- Modal -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div>
                    <h2 id="modalTitle"></h2>
                    <div id="modalBrand"></div>
                    <div id="modalBadges" class="badges"></div>
                </div>
                <button class="close-btn" onclick="forceCloseModal()">&times;</button>
            </div>
            
            <div class="modal-body">
                <div class="tabs">
                    <div class="tab active" onclick="switchTab(this, 'tab-pbs')">PBS Prescribing</div>
                    <div class="tab" onclick="switchTab(this, 'tab-dosing')">Dosing & Efficacy</div>
                    <div class="tab" onclick="switchTab(this, 'tab-escalation')">Dose Escalation</div>
                    <div class="tab" onclick="switchTab(this, 'tab-safety')">Safety</div>
                </div>

                <div id="tab-pbs" class="tab-content active"><div id="pbs-dynamic-container"></div></div>
                <div id="tab-dosing" class="tab-content"></div>
                <div id="tab-escalation" class="tab-content"></div>
                <div id="tab-safety" class="tab-content"></div>
            </div>
        </div>
    </div>

    <script>
        let currentSettingContext = 'public'; 
        let currentMed = null;
        let currentSelectedIndication = 'all';

        function setGlobalContext(context) {
            currentSettingContext = context;
            document.getElementById('btn-context-public').classList.toggle('active', context === 'public');
            document.getElementById('btn-context-private').classList.toggle('active', context === 'private');
            if (document.getElementById('modalOverlay').classList.contains('active') && currentMed) {
                renderTable();
                updateContextBadge();
            }
        }

        const medications = [
            {
                name: "Ustekinumab",
                brand: "Stelara, Steqeyma",
                classGroup: "Anti-Integrin / IL",
                routes: ["IV", "SC"],
                indications: ["UC", "CD"],
                dosing: `
                    <h3>Standard Dosing</h3>
                    <ul>
                        <li><span class="highlight-text">IV Induction (Wk 0):</span> Weight-based single dose.</li>
                        <li><span class="highlight-text">SC Maintenance:</span> 90 mg SC at Wk 8, then q8w.</li>
                    </ul>
                `,
                escalation: `
                    <div class="escalation-grid">
                        <div class="esc-card esc-pbs">
                            <div class="esc-header">‚úÖ PBS Allowed</div>
                            <div class="esc-body"><ul><li><strong>Shortening to q8w:</strong> Allowed if initiated on q12w.</li></ul></div>
                        </div>
                        <div class="esc-card esc-comp">
                            <div class="esc-header">‚ö†Ô∏è Hospital / Compassionate</div>
                            <div class="esc-body"><ul><li><strong>Interval Shortening:</strong> Decreasing SC to q4w or q6w.</li><li><strong>IV Re-induction:</strong> Second weight-based IV dose.</li></ul></div>
                        </div>
                    </div>
                `,
                safety: `<div class="alert-box"><strong>Pregnancy B1:</strong> Likely safe.</div>`,
                pbsRules: {
                    criteria: "Failed conventional therapy.",
                    hasWeightCalc: true,
                    calcType: "ustekinumab",
                    data: [
                        { ind: "UC", phase: "Initial (IV Load)", form: "130mg IV Vial", auth: "Written / PRODA", itemCode: "13272M", slCode: "-", qty: "Max 4", rpts: "0", context: "public" },
                        { ind: "UC", phase: "Initial (IV Load)", form: "130mg IV Vial", auth: "Written / PRODA", itemCode: "13255P", slCode: "-", qty: "Max 4", rpts: "0", context: "private" },
                        { ind: "UC", phase: "Balance (SC)", form: "90mg SC Syr", auth: "Telephone", itemCode: "13273N (Stelara)", slCode: "-", qty: "1", rpts: "0", context: "both" },
                        { ind: "UC", phase: "1st Cont.", form: "90mg SC Syr", auth: "Written / PRODA", itemCode: "13261Y (Stelara)", slCode: "-", qty: "1", rpts: "2", context: "both" },
                        { ind: "UC", phase: "Subs Cont.", form: "90mg SC Syr (Stelara)", auth: "STREAMLINED", itemCode: "13261Y", slCode: "16945", qty: "1", rpts: "2", context: "both" },
                        { ind: "UC", phase: "Subs Cont.", form: "90mg SC Syr (Steqeyma)", auth: "STREAMLINED", itemCode: "14918E", slCode: "16945", qty: "1", rpts: "2", context: "both" },
                        
                        { ind: "CD", phase: "Initial (IV Load)", form: "130mg IV Vial", auth: "Written / PRODA", itemCode: "11182M", slCode: "-", qty: "Max 4", rpts: "0", context: "public" },
                        { ind: "CD", phase: "Initial (IV Load)", form: "130mg IV Vial", auth: "Written / PRODA", itemCode: "11164N", slCode: "-", qty: "Max 4", rpts: "0", context: "private" },
                        { ind: "CD", phase: "Balance (SC)", form: "90mg SC (1x 90mg)", auth: "Telephone", itemCode: "14934B (Stelara)", slCode: "-", qty: "1", rpts: "0", context: "both" },
                        { ind: "CD", phase: "Balance (SC)", form: "90mg SC (as 2x 45mg)", auth: "Telephone", itemCode: "11178H (Stelara)", slCode: "-", qty: "2", rpts: "0", context: "both" },
                        { ind: "CD", phase: "1st Cont.", form: "90mg SC (as 2x 45mg)", auth: "Written / PRODA", itemCode: "11178H (Stelara)", slCode: "-", qty: "2", rpts: "1", context: "both" },
                        { ind: "CD", phase: "Subs Cont.", form: "90mg SC Syr (Stelara)", auth: "STREAMLINED", itemCode: "14926N", slCode: "16909", qty: "1", rpts: "1", context: "both" },
                        { ind: "CD", phase: "Subs Cont.", form: "90mg SC (as 2x 45mg) (Steqeyma)", auth: "STREAMLINED", itemCode: "14909Q", slCode: "16913", qty: "2", rpts: "1", context: "both" }
                    ]
                }
            },
            {
                name: "Adalimumab",
                brand: "Humira, Amgevita, Hadlima, Hyrimoz, Yuflyma",
                classGroup: "Anti-TNFŒ±",
                routes: ["SC"],
                indications: ["UC", "CD", "fCD"],
                dosing: `<ul><li><span class="highlight-text">Induction:</span> 160 mg SC Wk 0, 80 mg SC Wk 2.</li><li><span class="highlight-text">Maintenance:</span> 40 mg SC every 2 weeks.</li></ul>`,
                escalation: `
                    <div class="escalation-grid">
                        <div class="esc-card esc-pbs">
                            <div class="esc-header">‚úÖ PBS Allowed</div>
                            <div class="esc-body"><ul><li><strong>Interval Shortening:</strong> 40 mg SC weekly.</li><li><strong>Dose Doubling:</strong> 80 mg SC every 2 weeks.</li></ul><p style="font-size:0.8rem; margin-top:5px;">Requires Authority demonstrating loss of response.</p></div>
                        </div>
                    </div>
                `,
                safety: `<div class="alert-box"><strong>Pregnancy B2:</strong> Low risk.</div>`,
                pbsRules: {
                    criteria: "Failed conventional therapy. Must meet severity criteria.",
                    hasWeightCalc: false,
                    data: [
                        { ind: "UC", phase: "Initial (Load 160mg)", form: "40mg Syr/Pen", auth: "Written / PRODA", itemCode: "12333D, 12382Q", slCode: "-", qty: "6", rpts: "0", context: "both" },
                        { ind: "UC", phase: "Initial (Load 160mg)", form: "80mg Syr/Pen", auth: "Written / PRODA", itemCode: "12339K, 12374G", slCode: "-", qty: "3", rpts: "0", context: "both" },
                        { ind: "UC", phase: "Balance", form: "40mg Syr/Pen", auth: "Telephone", itemCode: "10944B, 12359L", slCode: "-", qty: "2", rpts: "2", context: "both" },
                        { ind: "UC", phase: "1st Cont.", form: "40mg Syr/Pen", auth: "Written / PRODA", itemCode: "10960W, 12391E", slCode: "-", qty: "2", rpts: "5", context: "both" },
                        { ind: "UC", phase: "Subs Cont.", form: "40mg (Humira)", auth: "STREAMLINED", itemCode: "12325Q", slCode: "16991", qty: "2", rpts: "5", context: "both" },
                        
                        { ind: "CD", phase: "Initial (Load 160mg)", form: "40mg Syr/Pen", auth: "Written / PRODA", itemCode: "12387Y, 12453K", slCode: "-", qty: "6", rpts: "0", context: "both" },
                        { ind: "CD", phase: "Initial (Load 160mg)", form: "80mg Syr/Pen", auth: "Written / PRODA", itemCode: "12372E, 12419P", slCode: "-", qty: "3", rpts: "0", context: "both" },
                        { ind: "CD", phase: "Balance", form: "40mg Syr/Pen", auth: "Telephone", itemCode: "9188N, 12451H", slCode: "-", qty: "2", rpts: "2", context: "both" },
                        { ind: "CD", phase: "1st Cont.", form: "40mg Syr/Pen", auth: "Written / PRODA", itemCode: "9189P, 12410E", slCode: "-", qty: "2", rpts: "5", context: "both" },
                        { ind: "CD", phase: "Subs Cont.", form: "40mg (Amgevita)", auth: "STREAMLINED", itemCode: "12437N", slCode: "11631", qty: "2", rpts: "5", context: "both" },
                        
                        { ind: "fCD", phase: "Initial (Load 160mg)", form: "40mg Syr/Pen", auth: "Written / PRODA", itemCode: "12387Y", slCode: "-", qty: "6", rpts: "0", context: "both" },
                        { ind: "fCD", phase: "Continuing", form: "40mg Syr/Pen", auth: "Telephone", itemCode: "8964T", slCode: "-", qty: "2", rpts: "5", context: "both" }
                    ]
                }
            },
            {
                name: "Infliximab",
                brand: "Remicade, Remsima, Inflectra",
                classGroup: "Anti-TNFŒ±",
                routes: ["IV", "SC"],
                indications: ["ASUC", "UC", "CD", "fCD"],
                dosing: `<ul><li><span class="highlight-text">IV Induction:</span> 5 mg/kg IV Wk 0, 2, 6.</li><li><span class="highlight-text">SC Maintenance:</span> 120 mg SC q2w.</li></ul>`,
                escalation: `
                    <div class="escalation-grid">
                        <div class="esc-card esc-pbs">
                            <div class="esc-header">‚úÖ PBS Allowed</div>
                            <div class="esc-body"><ul><li><strong>IV Escalation:</strong> Shortening IV interval (e.g., q6w or q4w) OR doubling dose (10mg/kg q8w) is allowed ONLY IF total dose is ‚â§ 5 vials.</li></ul></div>
                        </div>
                        <div class="esc-card esc-comp">
                            <div class="esc-header">‚ö†Ô∏è Hosp / Compassionate</div>
                            <div class="esc-body"><ul><li><strong>High Dose IV:</strong> >5 vials requires hospital funding.</li><li><strong>Subcut Escalation:</strong> 120mg weekly NOT PBS listed.</li></ul></div>
                        </div>
                    </div>
                `,
                safety: `<div class="alert-box"><strong>Pregnancy B2:</strong> Low risk.</div>`,
                pbsRules: {
                    criteria: "Failed conventional therapy.",
                    hasWeightCalc: true,
                    calcType: "infliximab",
                    data: [
                        { ind: "ASUC", phase: "Initial (Rescue)", form: "100mg IV Vial", auth: "Written / PRODA", itemCode: "10067W", slCode: "-", qty: "X*", rpts: "1", context: "public" },
                        { ind: "ASUC", phase: "Initial (Rescue)", form: "100mg IV Vial", auth: "Written / PRODA", itemCode: "10057H", slCode: "-", qty: "X*", rpts: "1", context: "private" },
                        
                        { ind: "UC", phase: "Initial (IV Load)", form: "100mg IV Vial", auth: "Written / PRODA", itemCode: "10196P", slCode: "-", qty: "X*", rpts: "2", context: "public" },
                        { ind: "UC", phase: "Initial (IV Load)", form: "100mg IV Vial", auth: "Written / PRODA", itemCode: "10184B", slCode: "-", qty: "X*", rpts: "2", context: "private" },
                        { ind: "UC", phase: "Continuing (IV)", form: "100mg IV Vial", auth: "Telephone", itemCode: "11459D", slCode: "-", qty: "X*", rpts: "2", context: "public" },
                        { ind: "UC", phase: "Continuing (IV)", form: "100mg IV Vial", auth: "Telephone", itemCode: "11797X", slCode: "-", qty: "X*", rpts: "2", context: "private" },
                        { ind: "UC", phase: "Switch to SC", form: "120mg SC (Remsima)", auth: "STREAMLINED", itemCode: "12586K", slCode: "17432", qty: "2", rpts: "5", context: "both" },
                        { ind: "UC", phase: "Continuing (SC)", form: "120mg SC (Remsima)", auth: "Telephone", itemCode: "12561D", slCode: "-", qty: "2", rpts: "2", context: "both" },

                        { ind: "CD", phase: "Initial (IV Load)", form: "100mg IV Vial", auth: "Written / PRODA", itemCode: "9654D", slCode: "-", qty: "X*", rpts: "2", context: "public" },
                        { ind: "CD", phase: "Initial (IV Load)", form: "100mg IV Vial", auth: "Written / PRODA", itemCode: "9674E", slCode: "-", qty: "X*", rpts: "2", context: "private" },
                        { ind: "CD", phase: "Continuing (IV)", form: "100mg IV Vial", auth: "Telephone", itemCode: "11424G", slCode: "-", qty: "X*", rpts: "2", context: "public" },
                        { ind: "CD", phase: "Continuing (IV)", form: "100mg IV Vial", auth: "Telephone", itemCode: "11412P", slCode: "-", qty: "X*", rpts: "2", context: "private" },
                        { ind: "CD", phase: "Switch to SC", form: "120mg SC (Remsima)", auth: "STREAMLINED", itemCode: "13073C", slCode: "17533", qty: "2", rpts: "5", context: "both" },
                        { ind: "CD", phase: "Continuing (SC)", form: "120mg SC (Remsima)", auth: "Telephone", itemCode: "12585J", slCode: "-", qty: "2", rpts: "2", context: "both" },
                        
                        { ind: "fCD", phase: "Continuing (SC)", form: "120mg SC (Remsima)", auth: "Telephone", itemCode: "13072B", slCode: "-", qty: "2", rpts: "2", context: "both" }
                    ]
                }
            },
            {
                name: "Vedolizumab",
                brand: "Entyvio",
                classGroup: "Anti-Integrin / IL",
                routes: ["IV", "SC"],
                indications: ["UC", "CD"],
                dosing: `<ul><li><span class="highlight-text">IV Induction:</span> 300 mg IV Wk 0, 2, 6.</li><li><span class="highlight-text">SC Maintenance:</span> 108 mg SC q2w.</li></ul>`,
                escalation: `
                    <div class="escalation-grid">
                        <div class="esc-card esc-pbs">
                            <div class="esc-header">‚úÖ PBS Allowed</div>
                            <div class="esc-body"><ul><li><strong>IV Interval Shortening:</strong> Increasing IV frequency to 300mg <strong>every 4 weeks</strong> is allowed.</li></ul></div>
                        </div>
                        <div class="esc-card esc-comp">
                            <div class="esc-header">‚ö†Ô∏è Hosp / Compassionate</div>
                            <div class="esc-body"><ul><li><strong>Subcut Escalation:</strong> 108mg <strong>weekly</strong> is NOT PBS listed.</li></ul></div>
                        </div>
                    </div>
                `,
                safety: `<div class="alert-box"><strong>Pregnancy B2:</strong> Low risk.</div>`,
                pbsRules: {
                    criteria: "Failed conventional therapy.",
                    hasWeightCalc: false,
                    data: [
                        { ind: "UC", phase: "Initial (IV Load)", form: "300mg IV Vial", auth: "Written / PRODA", itemCode: "10384M", slCode: "-", qty: "1", rpts: "2", context: "public" },
                        { ind: "UC", phase: "Initial (IV Load)", form: "300mg IV Vial", auth: "Written / PRODA", itemCode: "10398G", slCode: "-", qty: "1", rpts: "2", context: "private" },
                        { ind: "UC", phase: "Switch to SC", form: "108mg SC Pen", auth: "Written / PRODA", itemCode: "12644L", slCode: "-", qty: "2", rpts: "0", context: "both" },
                        { ind: "UC", phase: "Continuing (SC)", form: "108mg SC Pen", auth: "Telephone", itemCode: "12639F", slCode: "-", qty: "2", rpts: "5", context: "both" },
                        
                        { ind: "CD", phase: "Initial (IV Load)", form: "300mg IV Vial", auth: "Written / PRODA", itemCode: "10390W", slCode: "-", qty: "1", rpts: "2", context: "public" },
                        { ind: "CD", phase: "Initial (IV Load)", form: "300mg IV Vial", auth: "Written / PRODA", itemCode: "10415E", slCode: "-", qty: "1", rpts: "2", context: "private" },
                        { ind: "CD", phase: "Switch to SC", form: "108mg SC Pen", auth: "Written / PRODA", itemCode: "12638E", slCode: "-", qty: "2", rpts: "0", context: "both" },
                        { ind: "CD", phase: "Continuing (SC)", form: "108mg SC Pen", auth: "Telephone", itemCode: "12654B", slCode: "-", qty: "2", rpts: "5", context: "both" }
                    ]
                }
            },
            {
                name: "Upadacitinib",
                brand: "Rinvoq",
                classGroup: "JAK Inhibitor",
                routes: ["PO"],
                indications: ["UC", "CD"],
                dosing: `<ul><li><span class="highlight-text">Induction:</span> 45 mg daily.</li><li><span class="highlight-text">Maintenance:</span> 15 mg or 30 mg daily.</li></ul>`,
                escalation: `
                    <div class="escalation-grid">
                        <div class="esc-card esc-pbs">
                            <div class="esc-header">‚úÖ PBS Allowed</div>
                            <div class="esc-body"><ul><li><strong>Induction Extension:</strong> 45mg can be extended (16wks UC, 24wks CD).</li><li><strong>Maintenance Step-Up:</strong> Stepping up from 15mg to <strong>30mg daily</strong> is supported.</li></ul></div>
                        </div>
                    </div>
                `,
                safety: `<div class="alert-box danger"><strong>Pregnancy D:</strong> Contraindicated.</div>`,
                pbsRules: {
                    criteria: "UC: Failed 1 prior biologic. CD: Failed 2 prior biologics.",
                    hasWeightCalc: false,
                    data: [
                        { ind: "UC", phase: "Initial", form: "45mg Tabs", auth: "Written / PRODA", itemCode: "13262B", slCode: "-", qty: "28", rpts: "3", context: "both" },
                        { ind: "UC", phase: "1st Cont.", form: "15mg Tabs", auth: "Written / PRODA", itemCode: "13250J", slCode: "-", qty: "28", rpts: "5", context: "both" },
                        { ind: "UC", phase: "Subs Cont.", form: "15mg Tabs", auth: "STREAMLINED", itemCode: "13256Q", slCode: "16991", qty: "28", rpts: "5", context: "both" },
                        { ind: "UC", phase: "Subs Cont.", form: "30mg Tabs", auth: "STREAMLINED", itemCode: "13265E", slCode: "16991", qty: "28", rpts: "5", context: "both" },
                        
                        { ind: "CD", phase: "Initial", form: "45mg Tabs", auth: "Written / PRODA", itemCode: "13771T", slCode: "-", qty: "28", rpts: "2", context: "both" },
                        { ind: "CD", phase: "1st Cont.", form: "15mg Tabs", auth: "Written / PRODA", itemCode: "13768P", slCode: "-", qty: "28", rpts: "5", context: "both" },
                        { ind: "CD", phase: "Subs Cont.", form: "30mg Tabs", auth: "STREAMLINED", itemCode: "13746L", slCode: "11631", qty: "28", rpts: "5", context: "both" }
                    ]
                }
            },
            {
                name: "Tofacitinib",
                brand: "Xeljanz",
                classGroup: "JAK Inhibitor",
                routes: ["PO"],
                indications: ["UC"],
                dosing: `<ul><li><span class="highlight-text">Induction:</span> 10 mg BD.</li><li><span class="highlight-text">Maintenance:</span> 5 mg BD.</li></ul>`,
                escalation: `
                    <div class="escalation-grid">
                        <div class="esc-card esc-pbs">
                            <div class="esc-header">‚úÖ PBS Allowed</div>
                            <div class="esc-body"><ul><li><strong>Maintenance Step-Up:</strong> Maintaining long-term on <strong>10mg BD</strong> is PBS allowed.</li></ul></div>
                        </div>
                        <div class="esc-card esc-comp">
                            <div class="esc-header">‚ö†Ô∏è Off-Label</div>
                            <div class="esc-body"><ul><li><strong>ASUC Rescue:</strong> 10mg TDS is an off-label hospital protocol.</li></ul></div>
                        </div>
                    </div>
                `,
                safety: `<div class="alert-box danger"><strong>Pregnancy D:</strong> Contraindicated.</div>`,
                pbsRules: {
                    criteria: "Failed anti-TNFŒ± OR vedolizumab.",
                    hasWeightCalc: false,
                    data: [
                        { ind: "UC", phase: "Initial", form: "10mg Tabs", auth: "Written / PRODA", itemCode: "12588M", slCode: "-", qty: "56", rpts: "3", context: "both" },
                        { ind: "UC", phase: "Continuing", form: "10mg Tabs", auth: "Telephone", itemCode: "12589N", slCode: "-", qty: "56", rpts: "5", context: "both" },
                        { ind: "UC", phase: "Initial", form: "5mg Tabs", auth: "Written / PRODA", itemCode: "12556W", slCode: "-", qty: "56", rpts: "3", context: "both" },
                        { ind: "UC", phase: "Continuing", form: "5mg Tabs", auth: "Telephone", itemCode: "12557X", slCode: "-", qty: "56", rpts: "5", context: "both" }
                    ]
                }
            }
        ];

        // --- RENDER LOGIC ---
        const grid = document.getElementById('med-grid');
        const searchInput = document.getElementById('searchInput');
        const classFilter = document.getElementById('classFilter');
        const indFilter = document.getElementById('indicationFilter');

        function renderCards() {
            const search = searchInput.value.toLowerCase();
            const filterClass = classFilter.value;
            const filterInd = indFilter.value;

            grid.innerHTML = '';
            const filtered = medications.filter(m => {
                const matchSearch = m.name.toLowerCase().includes(search) || m.brand.toLowerCase().includes(search);
                const matchClass = filterClass === 'all' || m.classGroup === filterClass;
                const matchInd = filterInd === 'all' || m.indications.includes(filterInd);
                return matchSearch && matchClass && matchInd;
            });

            filtered.forEach((med) => {
                const routesHtml = med.routes.map(r => `<span class="badge bg-${r.toLowerCase()}">${r}</span>`).join('');
                const indHtml = med.indications.map(i => `<span class="badge bg-ind">${i}</span>`).join('');
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div class="card-header"><h2 class="card-title">${med.name}</h2></div>
                    <div class="card-brand">${med.brand}</div>
                    <div class="card-class">${med.classGroup}</div>
                    <div class="badges">${routesHtml}${indHtml}</div>
                `;
                card.onclick = () => openModal(med);
                grid.appendChild(card);
            });
        }

        searchInput.addEventListener('input', renderCards);
        classFilter.addEventListener('change', renderCards);
        indFilter.addEventListener('change', renderCards);

        // --- MODAL & DYNAMIC PBS ENGINE ---
        const modalOverlay = document.getElementById('modalOverlay');
        const tabDosing = document.getElementById('tab-dosing');
        const tabEscalation = document.getElementById('tab-escalation');
        const tabSafety = document.getElementById('tab-safety');

        function openModal(med) {
            currentMed = med;
            document.getElementById('modalTitle').textContent = med.name;
            document.getElementById('modalBrand').textContent = med.brand;
            
            const routesHtml = med.routes.map(r => `<span class="badge bg-${r.toLowerCase()}">${r}</span>`).join('');
            const indHtml = med.indications.map(i => `<span class="badge bg-ind">${i}</span>`).join('');
            document.getElementById('modalBadges').innerHTML = routesHtml + indHtml + `<span class="badge bg-class">${med.classGroup}</span>`;

            tabDosing.innerHTML = med.dosing;
            tabEscalation.innerHTML = med.escalation || '<p style="color:var(--text-muted); font-style:italic;">No dose escalation pathways currently recommended or funded.</p>';
            tabSafety.innerHTML = med.safety;
            
            currentSelectedIndication = med.indications.length > 0 ? med.indications[0] : 'all';
            buildPBSUI(med);

            document.querySelectorAll('.tab').forEach((t, i) => { i === 0 ? t.classList.add('active') : t.classList.remove('active'); });
            document.querySelectorAll('.tab-content').forEach((tc, i) => { i === 0 ? tc.classList.add('active') : tc.classList.remove('active'); });

            modalOverlay.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal(e) { if (e.target === modalOverlay) forceCloseModal(); }
        function forceCloseModal() { modalOverlay.classList.remove('active'); document.body.style.overflow = 'auto'; }

        function switchTab(clickedTab, targetId) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
            clickedTab.classList.add('active');
            document.getElementById(targetId).classList.add('active');
        }

        // --- PBS ENGINE LOGIC ---
        function buildPBSUI(med) {
            const container = document.getElementById('pbs-dynamic-container');
            container.innerHTML = '';
            if (!med.pbsRules) return;

            let html = `<div class="alert-box"><strong>Criteria:</strong> ${med.pbsRules.criteria}</div>`;

            if (med.pbsRules.hasWeightCalc) {
                html += `
                    <div class="weight-calculator">
                        <div>
                            <div style="font-size: 0.8rem; font-weight: 700; color: var(--primary); text-transform: uppercase; margin-bottom: 0.2rem;">Patient Weight</div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="number" class="weight-input" id="calcWeight" placeholder="e.g. 75"> <span>kg</span>
                            </div>
                        </div>
                        <div class="weight-result" id="calcOutput">Enter weight to calculate precise induction dose.</div>
                    </div>
                `;
            }

            const availableInds = [...new Set(med.pbsRules.data.map(d => d.ind))];
            let pillsHtml = availableInds.map(i => `<button class="pill-btn ${i === currentSelectedIndication ? 'active' : ''}" onclick="setIndication('${i}')">${i}</button>`).join('');

            html += `
                <div class="pbs-controls-header">
                    <div class="pill-group" id="ind-pills">
                        ${pillsHtml}
                        <div class="context-badge" id="contextBadgeDisplay"></div>
                    </div>
                    <div class="phase-explainer">
                        <div class="phase-explainer-header" onclick="toggleExplainer()">
                            <span>üí° What do the PBS Phases mean?</span><span id="explainer-icon">‚ñº</span>
                        </div>
                        <div class="phase-explainer-content" id="explainer-content">
                            <ul>
                                <li><strong>Initial (Induction):</strong> First script. Requires baseline clinical scores via Written/PRODA.</li>
                                <li><strong>Balance of Supply:</strong> Completes induction before evaluating maintenance. Usually Telephone.</li>
                                <li><strong>1st Continuing:</strong> First maintenance script. Needs clinical response via Written/PRODA.</li>
                                <li><strong>Subsequent Continuing:</strong> Ongoing maintenance. Often <strong>STREAMLINED</strong> (no phone call). Put both Item & Streamline codes on script.</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="pbs-table-wrapper">
                    <table class="pbs-table">
                        <thead><tr><th>Phase</th><th>Formulation</th><th>Authority</th><th>Item Code</th><th>Streamlined</th><th>Qty</th><th>Rpt</th></tr></thead>
                        <tbody id="pbsTableBody"></tbody>
                    </table>
                </div>
            `;
            
            container.innerHTML = html;
            updateContextBadge();
            if (med.pbsRules.hasWeightCalc) {
                document.getElementById('calcWeight').addEventListener('input', (e) => calculateDose(e.target.value, med.pbsRules.calcType));
            }
            renderTable();
        }

        function updateContextBadge() {
            const badge = document.getElementById('contextBadgeDisplay');
            if (badge) {
                badge.textContent = currentSettingContext === 'public' ? 'üè• Public Hosp (S100)' : 'üè¢ Private Hosp / Comm';
            }
        }

        function toggleExplainer() {
            const content = document.getElementById('explainer-content');
            const icon = document.getElementById('explainer-icon');
            content.classList.toggle('active');
            icon.textContent = content.classList.contains('active') ? '‚ñ≤' : '‚ñº';
        }

        function setIndication(ind) {
            currentSelectedIndication = ind;
            document.querySelectorAll('#ind-pills .pill-btn').forEach(btn => {
                btn.classList.toggle('active', btn.textContent === ind);
            });
            renderTable();
        }

        function calculateDose(weight, type) {
            const out = document.getElementById('calcOutput');
            if (!weight || weight <= 0) { out.textContent = "Enter weight to calculate induction dose."; return; }
            if (type === 'infliximab') {
                let dose = weight * 5; let vials = Math.ceil(dose / 100);
                out.innerHTML = `Dose: <strong>${dose} mg</strong> &rarr; Prescribe <strong>${vials} x 100mg vials</strong>.`;
            } else if (type === 'ustekinumab') {
                let dose = weight <= 55 ? 260 : weight <= 85 ? 390 : 520;
                let vials = weight <= 55 ? 2 : weight <= 85 ? 3 : 4;
                out.innerHTML = `Dose: <strong>${dose} mg</strong> &rarr; Prescribe <strong>${vials} x 130mg vials</strong>.`;
            }
        }

        function renderTable() {
            const tbody = document.getElementById('pbsTableBody');
            
            const filtered = currentMed.pbsRules.data.filter(d => 
                (d.ind === currentSelectedIndication) && 
                (d.context === 'both' || d.context === currentSettingContext)
            );

            if(filtered.length === 0) {
                tbody.innerHTML = `<tr><td colspan="7" style="text-align:center; color:var(--text-muted); padding:2rem;">No matching PBS codes found for this setting.</td></tr>`;
                return;
            }

            tbody.innerHTML = filtered.map(d => {
                let authClass = 'auth-written';
                if(d.auth.includes('Telephone')) authClass = 'auth-phone';
                if(d.auth.includes('STREAMLINED')) authClass = 'auth-streamlined';

                let itemHtml = d.itemCode.split(', ').map(c => {
                    let clean = c.split(' ')[0];
                    return `<div class="td-codes"><span class="code-pill" onclick="copyCode(this, '${clean}')" title="Copy Item Code">${c}</span></div>`;
                }).join('');

                let slHtml = d.slCode === '-' ? '<span style="color:var(--text-muted)">N/A</span>' : 
                    `<span class="code-pill code-streamline" onclick="copyCode(this, '${d.slCode}')" title="Copy Streamline Code">${d.slCode}</span>`;

                return `
                <tr>
                    <td data-label="Phase"><strong>${d.phase}</strong></td>
                    <td data-label="Formulation">${d.form}</td>
                    <td data-label="Authority"><span class="auth-badge ${authClass}">${d.auth}</span></td>
                    <td data-label="Item Code">${itemHtml}</td>
                    <td data-label="Streamlined">${slHtml}</td>
                    <td data-label="Qty"><span class="qty-badge">${d.qty}</span></td>
                    <td data-label="Rpts"><span class="rpt-badge">${d.rpts}</span></td>
                </tr>
            `}).join('');
        }

        function copyCode(element, text) {
            navigator.clipboard.writeText(text).then(() => {
                const originalText = element.innerHTML;
                element.innerText = "Copied!";
                element.classList.add('code-copied');
                setTimeout(() => {
                    element.innerHTML = originalText;
                    element.classList.remove('code-copied');
                }, 1000);
            });
        }

        renderCards();
    </script>
</body>
</html>